{% extends 'base.html' %}

{% block content %}
<h2>Add / Restock Product</h2>
<form method="post" class="row g-3" novalidate>
  {{ form.hidden_tag() }}

  <!-- Product name field rendered as Select2 -->
  <div class="col-md-6 mb-3">
    <label for="name-select" class="form-label">Product name</label>
    <select id="name-select" name="name" class="form-select select2" style="width:100%" data-placeholder="Product name">
      <option></option>  <!-- blank placeholder -->
      {% for n in all_names %}
        <option value="{{ n }}">{{ n }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- Explicit safety_stock field
  <div class="col-md-6">
    {{ form.safety_stock.label(class_='form-label') }}
    {{ form.safety_stock(class_='form-control') }}
    {% if form.safety_stock.errors %}
      <div class="text-danger small">{{ form.safety_stock.errors[0] }}</div>
    {% endif %}
  </div> -->

  <!-- Render the rest of the fields -->
  {% for field in form if field.name not in ['csrf_token', 'name', 'submit'] %}
    <div class="col-md-6 form-floating">
      {{ field(class_='form-control' + (' is-invalid' if field.errors else ''), placeholder=field.label.text) }}
      {{ field.label(class_='form-label') }}
      {% if field.errors %}
        <div class="text-danger small">{{ field.errors[0] }}</div>
      {% endif %}
    </div>
  {% endfor %}

  <div class="col-12"><button id="submitBtn" class="btn btn-success" data-testid="add-stock"><span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span> Submit</button></div>
</form>
{% endblock %}

{% block scripts %}
<script>
$(function () {
  $('.select2').select2({
    placeholder: 'Type or pick product',
    allowClear: true,
    tags: true           // lets user add a brand-new name
  });

  // spinner on submit
  $('form').on('submit', function(){
    $('#submitBtn').prop('disabled', true);
    $('#submitBtn .spinner-border').removeClass('d-none');
  });
});
</script>
{% endblock %}